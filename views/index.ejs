<!DOCTYPE html>
<html>
<head>
  <title>Women Safety App</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="text-center mt-5">

  <div class="container">
    <h1>Emergency Assistance</h1>
    <div class="mt-4">
        <button id="startTrackingBtn" class="btn btn-danger btn-lg" onclick="startTracking()">ğŸš¨ Start Panic Mode</button>
        <button id="stopTrackingBtn" class="btn btn-warning btn-lg" onclick="stopTracking()">âœ‹ Stop Tracking</button>
        <button id="sendLocationBtn" class="btn btn-success btn-lg" onclick="sendLocationOnce()">ğŸ“ Send Location Once</button>
      </div>
    </div>  


</body>
<script>
    let watchId;
  
    function startTracking() {
      if (navigator.geolocation) {
        watchId = navigator.geolocation.watchPosition(
          async (position) => {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
  
            await fetch('/location', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              credentials: 'include', // ğŸ”’ Send session cookie
              body: JSON.stringify({ latitude, longitude }),
            });
          },
          (err) => {
            console.error("Error getting location", err);
          },
          { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }
  
    function stopTracking() {
      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
        alert("Tracking stopped.");
      }
    }
  
    async function sendLocationOnce() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;
  
          await fetch('/location', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'include', // ğŸ”’ Send session cookie
            body: JSON.stringify({ latitude, longitude }),
          });
  
          alert("ğŸ“ Location sent!");
        });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }
  </script>
  
</html>
